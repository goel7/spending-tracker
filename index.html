<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Spending Tracker</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <!-- Background layers -->
    <div class="bg">
      <div class="bg__grad"></div>
      <div class="bg__glow"></div>
      <div class="bg__noise"></div>
    </div>

    <!-- App shell -->
    <div class="shell">
      <!-- AUTH VIEW -->
      <main id="authView" class="view">
        <section class="hero">
          <h1 class="hero__title">Spending Tracker</h1>
          <p class="hero__subtitle">
            Quickly log spending + income. See monthly stats.
          </p>
        </section>

        <section class="card card--glass authCard">
          <h2 class="card__title" id="authTitle">Sign in</h2>
          <p class="card__muted" id="authSubtitle">
            Welcome back. Log in to see your data.
          </p>

          <form id="authForm" class="form" autocomplete="on">
            <label class="field">
              <span class="field__label">Email</span>
              <input
                id="authEmail"
                class="input"
                type="email"
                placeholder="you@email.com"
                required
              />
            </label>

            <label class="field">
              <span class="field__label">Password</span>
              <input
                id="authPassword"
                class="input"
                type="password"
                placeholder="Password"
                required
              />
            </label>

            <label id="confirmWrap" class="field hidden">
              <span class="field__label">Confirm password</span>
              <input
                id="authConfirm"
                class="input"
                type="password"
                placeholder="Confirm password"
              />
            </label>

            <div class="row row--gap authActions">
              <button
                id="btnAuthPrimary"
                class="btn btn--primary"
                type="submit"
              >
                Login
              </button>
              <button id="btnAuthToggle" class="btn btn--ghost" type="button">
                Sign up instead
              </button>
            </div>

            <div
              id="authMsg"
              class="msg hidden"
              role="status"
              aria-live="polite"
            ></div>

            <div class="divider">
              <span class="divider__line"></span>
              <span class="divider__text">or</span>
              <span class="divider__line"></span>
            </div>

            <button id="googleSignInBtn" class="btn googleBtn" type="button">
              <svg
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path
                  d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"
                  fill="#4285F4"
                ></path>
                <path
                  d="M9.003 18c2.43 0 4.467-.806 5.956-2.18L12.05 13.56c-.806.54-1.836.86-3.047.86-2.344 0-4.328-1.584-5.036-3.711H.96v2.332C2.44 15.983 5.485 18 9.003 18z"
                  fill="#34A853"
                ></path>
                <path
                  d="M3.964 10.71c-.18-.54-.282-1.117-.282-1.71s.102-1.17.282-1.71V4.958H.957C.347 6.173 0 7.548 0 9.001c0 1.452.348 2.827.957 4.041l3.007-2.332z"
                  fill="#FBBC05"
                ></path>
                <path
                  d="M9.003 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.464.891 11.426 0 9.003 0 5.485 0 2.44 2.017.96 4.958L3.967 7.29c.708-2.127 2.692-3.71 5.036-3.71z"
                  fill="#EA4335"
                ></path>
              </svg>
              Continue with Google
            </button>

            <p class="fineprint">New here? Create an account in 10 seconds.</p>
          </form>
        </section>
      </main>

      <!-- APP VIEW -->
      <main id="appView" class="view hidden">
        <!-- Header -->
        <header class="header">
          <div class="brand">
            <div class="brand__logo" aria-hidden="true">üí∞</div>
            <div class="brand__text">
              <div class="brand__title">Spending Tracker</div>
            </div>
          </div>

          <div class="header__actions">
            <div class="headerMenu">
              <button
                id="btnUserMenu"
                class="iconBtn iconBtn--sm hidden"
                type="button"
                aria-haspopup="menu"
                aria-expanded="false"
                aria-label="Account menu"
                title="Account"
              >
                ‚ò∞
              </button>
              <div id="headerMenu" class="headerMenu__panel hidden">
                <button id="btnImport" class="headerMenu__item" type="button">
                  Import CSV
                </button>
                <button id="btnExport" class="headerMenu__item" type="button">
                  Export CSV
                </button>
                <div class="headerMenu__divider"></div>
                <button
                  id="btnLogout"
                  class="headerMenu__item headerMenu__item--danger"
                  type="button"
                >
                  Logout
                </button>
              </div>
            </div>
          </div>
        </header>
        <!-- Monthly overview -->
        <section class="card card--glass monthCard">
          <div class="monthCard__head">
            <div class="monthCard__intro">
              <div class="monthCard__title">Monthly overview</div>
              <div class="monthCard__sub">
                Compare spending and income by month.
              </div>
            </div>
            <div class="monthCard__controls">
              <div class="selectWrap">
                <span class="selectWrap__icon" aria-hidden="true">üóìÔ∏è</span>
                <select
                  id="monthSelect"
                  class="input input--select input--sm input--selectInline"
                  aria-label="Select month"
                ></select>
              </div>
              <button
                id="btnAdvanced"
                class="btn btn--ghost btn--sm"
                type="button"
              >
                <span class="btn__icon" aria-hidden="true">‚öô</span>
              </button>
            </div>
          </div>

          <div class="monthStats">
            <div class="statTile statTile--expense">
              <div class="statTile__label">Spent</div>
              <div id="monthSpent" class="statTile__value">$0</div>
            </div>
            <div class="statTile statTile--income">
              <div class="statTile__label">Earned</div>
              <div id="monthEarned" class="statTile__value">$0</div>
            </div>
            <div class="statTile statTile--net">
              <div class="statTile__label">Net</div>
              <div id="monthNet" class="statTile__value">$0</div>
            </div>
          </div>
        </section>

        <!-- Transactions -->
        <section class="sectionHead">
          <h2 class="sectionHead__title">Transactions</h2>
          <div class="sectionHead__right">
            <label class="searchField" aria-label="Search">
              <span class="searchField__icon" aria-hidden="true">üîé</span>
              <input
                id="txSearch"
                class="input input--sm input--search"
                type="search"
                placeholder="Search..."
              />
            </label>
            <button
              id="btnFiltersToggle"
              class="btn btn--ghost btn--sm btn--filters"
              type="button"
              aria-label="Filters"
              aria-expanded="false"
              aria-controls="filtersPanel"
            >
              <span
                class="btn__icon btn__icon--sliders"
                aria-hidden="true"
              ></span>
            </button>
            <button
              id="btnSelectMode"
              class="btn btn--ghost btn--sm btn--select"
              type="button"
              aria-label="Toggle select mode"
              title="Select multiple transactions"
            >
              <span class="btn__icon" aria-hidden="true">‚òë</span>
              <span class="btn__text">Select</span>
            </button>

            <div id="filtersPanel" class="filtersPanel">
              <div class="filterGroup" role="group" aria-label="Filter type">
                <button
                  id="filterAll"
                  class="btn btn--ghost btn--sm isActive"
                  type="button"
                >
                  All
                </button>
                <button
                  id="filterSpent"
                  class="btn btn--ghost btn--sm"
                  type="button"
                >
                  Spent
                </button>
                <button
                  id="filterEarned"
                  class="btn btn--ghost btn--sm"
                  type="button"
                >
                  Earned
                </button>
              </div>

              <div class="categoryFilter">
                <div class="categoryFilter__header">
                  <button
                    id="categoryFilterToggle"
                    class="categoryFilter__toggle"
                    type="button"
                    aria-label="Filter by category"
                    aria-expanded="false"
                    aria-controls="categoryFilterPanel"
                  >
                    All categories
                  </button>
                </div>
                <div
                  id="categoryFilterPanel"
                  class="categoryFilter__panel hidden"
                  role="group"
                  aria-label="Filter by category"
                >
                  <div
                    class="categoryFilter__list"
                    id="categoryFilterList"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="card card--glass listCard">
          <div id="selectionBar" class="selectionBar hidden">
            <div class="selectionBar__header">
              <div class="selectionBar__actions">
                <button
                  id="btnDeleteSelected"
                  class="btn btn--danger btn--sm"
                  type="button"
                  aria-label="Delete selected transactions"
                  title="Delete"
                >
                  <span class="btn__icon" aria-hidden="true">üóë</span>
                </button>
                <button
                  id="btnSelectAll"
                  class="btn btn--ghost btn--sm"
                  type="button"
                >
                  Select all
                </button>
              </div>
              <button
                id="btnCloseSelection"
                class="btn btn--ghost btn--sm"
                type="button"
                aria-label="Close selection mode"
                title="Close"
              >
                ‚úï
              </button>
            </div>
            <div id="selectionCount" class="selectionBar__count">
              0 selected
            </div>
          </div>
          <div id="txList" class="txList"></div>
          <div id="emptyState" class="emptyState hidden">
            <div class="emptyState__emoji" aria-hidden="true">üßæ</div>
            <div class="emptyState__title">No transactions yet</div>
            <div class="emptyState__muted">
              Tap the + button to add your first one.
            </div>
          </div>
          <div id="txPager" class="txPager hidden">
            <button
              id="txPrev"
              class="btn btn--ghost btn--sm"
              type="button"
              aria-label="Previous transactions"
            >
              ‚Üê
            </button>
            <div id="txPagerLabel" class="txPager__label"></div>
            <button
              id="txNext"
              class="btn btn--ghost btn--sm"
              type="button"
              aria-label="Next transactions"
            >
              ‚Üí
            </button>
          </div>
        </section>
      </main>

      <!-- Floating Add Button -->
      <button
        id="fab"
        class="fab"
        aria-label="Add transaction"
        title="Add transaction"
      >
        <span class="fab__plus" aria-hidden="true">+</span>
      </button>

      <!-- Modal: Add Transaction -->
      <div
        id="modalOverlay"
        class="modalOverlay hidden"
        role="dialog"
        aria-modal="true"
        aria-hidden="true"
      >
        <div class="modal card card--glass">
          <div class="modal__head">
            <div>
              <div class="modal__title">Add transaction</div>
              <div class="modal__muted">Fast entry. You can edit later.</div>
            </div>
            <button
              id="btnModalClose"
              class="iconBtn"
              aria-label="Close modal"
              title="Close"
            >
              ‚úï
            </button>
          </div>

          <form id="txForm" class="form" autocomplete="off">
            <div class="grid2">
              <label class="field">
                <span class="field__label">Date</span>
                <input id="txDate" class="input" type="date" required />
              </label>

              <div class="field">
                <span class="field__label">Type</span>
                <div
                  class="segmented"
                  role="tablist"
                  aria-label="Transaction type"
                >
                  <button
                    id="typeExpense"
                    class="segmented__btn isActive"
                    type="button"
                    role="tab"
                    aria-selected="true"
                  >
                    Expense
                  </button>
                  <button
                    id="typeIncome"
                    class="segmented__btn"
                    type="button"
                    role="tab"
                    aria-selected="false"
                  >
                    Income
                  </button>
                </div>
              </div>
            </div>

            <label class="field">
              <span class="field__label">Item / description</span>
              <input
                id="txDesc"
                class="input"
                type="text"
                placeholder="e.g., Chipotle, Uber, Paycheck"
              />
            </label>

            <div class="grid2">
              <label class="field">
                <span class="field__label">Amount</span>
                <div class="money">
                  <span class="money__prefix" aria-hidden="true">$</span>
                  <input
                    id="txAmount"
                    class="input input--money"
                    type="number"
                    inputmode="decimal"
                    min="0"
                    step="0.01"
                    placeholder="0.00"
                    required
                  />
                </div>
              </label>

              <label class="field">
                <span class="field__label">Category</span>
                <div class="categoryRow">
                  <div class="categorySelect" id="txCategorySelect">
                    <button
                      id="txCategoryToggle"
                      class="input input--select categorySelect__toggle"
                      type="button"
                      aria-haspopup="listbox"
                      aria-expanded="false"
                      aria-controls="txCategoryPanel"
                    >
                      Select a category
                    </button>
                    <input id="txCategory" type="hidden" value="" />
                    <div
                      id="txCategoryPanel"
                      class="categorySelect__panel hidden"
                      role="listbox"
                    ></div>
                  </div>
                  <button
                    id="btnAddCategory"
                    class="iconBtn iconBtn--sm"
                    type="button"
                    aria-label="Add category"
                    title="Add category"
                  >
                    +
                  </button>
                  <button
                    id="btnManageCategories"
                    class="iconBtn iconBtn--sm"
                    type="button"
                    aria-label="Manage categories"
                    title="Manage categories"
                  >
                    ‚öô
                  </button>
                </div>
              </label>
            </div>

            <label class="field">
              <span class="field__label">Notes</span>
              <input
                id="txNote"
                class="input"
                type="text"
                placeholder="Optional note..."
              />
            </label>

            <button
              id="btnAddTx"
              class="btn btn--primary btn--full"
              type="submit"
            >
              Add transaction
            </button>
            <div
              id="txMsg"
              class="msg hidden"
              role="status"
              aria-live="polite"
            ></div>
          </form>
        </div>
      </div>

      <!-- Modal: Advanced range -->
      <div
        id="rangeOverlay"
        class="modalOverlay hidden"
        role="dialog"
        aria-modal="true"
        aria-hidden="true"
      >
        <div class="modal card card--glass modal--range">
          <div class="modal__head">
            <div>
              <div class="modal__title">Date range totals</div>
            </div>
            <button
              id="btnRangeClose"
              class="iconBtn"
              aria-label="Close advanced range"
              title="Close"
            >
              ‚úï
            </button>
          </div>

          <div id="rangePanel" class="rangePanel">
            <div class="rangePanel__controls">
              <label class="field field--compact">
                <span class="field__label">Start</span>
                <input id="rangeStart" class="input input--sm" type="date" />
              </label>
              <label class="field field--compact">
                <span class="field__label">End</span>
                <input id="rangeEnd" class="input input--sm" type="date" />
              </label>
              <button
                id="btnRangeApply"
                class="btn btn--primary btn--sm"
                type="button"
              >
                Apply
              </button>
            </div>

            <div class="rangeStats">
              <div class="statTile statTile--expense">
                <div class="statTile__label">Spent</div>
                <div id="rangeSpent" class="statTile__value">$0</div>
              </div>
              <div class="statTile statTile--income">
                <div class="statTile__label">Earned</div>
                <div id="rangeEarned" class="statTile__value">$0</div>
              </div>
              <div class="statTile statTile--net">
                <div class="statTile__label">Net</div>
                <div id="rangeNet" class="statTile__value">$0</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal: Import CSV -->
      <div
        id="importOverlay"
        class="modalOverlay hidden"
        role="dialog"
        aria-modal="true"
        aria-hidden="true"
      >
        <div class="modal card card--glass modal--import">
          <div class="modal__head">
            <div>
              <div class="modal__title">Import CSV</div>
              <div class="modal__muted">
                Match columns to fields, then import.
              </div>
            </div>
            <button
              id="btnImportClose"
              class="iconBtn"
              aria-label="Close import"
              title="Close"
            >
              ‚úï
            </button>
          </div>

          <div class="importStack">
            <div class="importRow importRow--file">
              <label class="field">
                <span class="field__label">CSV file</span>
                <input
                  id="importFile"
                  class="input importFileInput"
                  type="file"
                  accept=".csv,text/csv"
                />
                <span class="field__helper">
                  Tip: Use columns like Date, Description, Amount, Category,
                  Note, Expense / Income.
                </span>
              </label>
            </div>
            <label class="importToggle">
              <input id="importHasHeader" type="checkbox" checked />
              <span>First row is headers</span>
            </label>
          </div>

          <div class="importMap">
            <div class="importMap__title">Column mapping</div>
            <div class="importMap__grid">
              <label class="field">
                <span class="field__label">Date</span>
                <select id="importMapDate" class="input input--select"></select>
              </label>
              <label class="field">
                <span class="field__label">Description</span>
                <select id="importMapDesc" class="input input--select"></select>
              </label>
              <label class="field">
                <span class="field__label">Amount</span>
                <select
                  id="importMapAmount"
                  class="input input--select"
                ></select>
              </label>
              <label class="field">
                <span class="field__label">Category</span>
                <select
                  id="importMapCategory"
                  class="input input--select"
                ></select>
              </label>
              <label class="field">
                <span class="field__label">Note</span>
                <select id="importMapNote" class="input input--select"></select>
              </label>
              <label class="field">
                <span class="field__label">Expense / Income</span>
                <select id="importMapType" class="input input--select"></select>
              </label>
            </div>
            <div class="importMap__footer">
              <label class="field field--compact">
                <span class="field__label">Default Expense / Income</span>
                <select
                  id="importDefaultType"
                  class="input input--select input--sm"
                >
                  <option value="expense">Expense</option>
                  <option value="income">Income</option>
                </select>
              </label>
            </div>
            <div class="importMap__hintRow">
              <div class="importHint">
                Note: If Expense / Income column is missing, we use the default.
                Negative amounts are treated as expenses.
              </div>
            </div>
          </div>

          <div class="importPreview">
            <div class="importPreview__title">Preview</div>
            <div id="importPreviewTable" class="importPreview__table"></div>
          </div>

          <div class="row row--gap row--end">
            <button id="btnImportCancel" class="btn btn--ghost" type="button">
              Cancel
            </button>
            <button id="btnImportRun" class="btn btn--primary" type="button">
              Import
            </button>
          </div>

          <div
            id="importMsg"
            class="msg hidden"
            role="status"
            aria-live="polite"
          ></div>
        </div>
      </div>

      <!-- Tiny toast -->
      <div
        id="toast"
        class="toast hidden"
        role="status"
        aria-live="polite"
      ></div>
    </div>

    <!-- Modal: Add Category -->
    <div
      id="addCatOverlay"
      class="modalOverlay hidden"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div class="modal card card--glass modal--sm">
        <div class="modal__head">
          <div>
            <div class="modal__title">Add Category</div>
          </div>
          <button
            id="btnAddCatClose"
            class="iconBtn"
            aria-label="Close add category"
            title="Close"
          >
            ‚úï
          </button>
        </div>

        <form id="addCatForm" class="form" autocomplete="off">
          <label class="field">
            <span class="field__label">Category name</span>
            <input
              id="addCatInput"
              class="input"
              type="text"
              placeholder="e.g., Groceries"
              required
            />
          </label>

          <div class="row row--gap row--end">
            <button id="btnAddCatCancel" class="btn btn--ghost" type="button">
              Cancel
            </button>
            <button id="btnAddCatSave" class="btn btn--primary" type="submit">
              Save
            </button>
          </div>

          <div
            id="addCatMsg"
            class="msg hidden"
            role="status"
            aria-live="polite"
          ></div>
        </form>
      </div>
    </div>

    <!-- Modal: Manage Categories -->
    <div
      id="manageCatOverlay"
      class="modalOverlay hidden"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div class="modal card card--glass modal--manage">
        <div class="modal__head">
          <div>
            <div class="modal__title">Categories</div>
            <div class="modal__muted">
              Create, rename, or delete categories.
            </div>
          </div>
          <div class="modal__actions">
            <button
              id="btnManageCatAdd"
              class="btn btn--ghost btn--sm"
              type="button"
            >
              + Add
            </button>
            <button
              id="btnManageCatClose"
              class="iconBtn"
              aria-label="Close categories"
              title="Close"
            >
              ‚úï
            </button>
          </div>
        </div>

        <div id="manageCatList" class="catList"></div>
      </div>
    </div>

    <!-- Confirm Modal -->
    <div
      id="confirmOverlay"
      class="modalOverlay hidden"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
    >
      <div class="modal card card--glass modal--sm modal--confirm">
        <div class="modal__head">
          <div class="confirmBody">
            <div id="confirmTitle" class="modal__title">Confirm</div>
            <div id="confirmSubtitle" class="modal__muted">Are you sure?</div>
          </div>
          <button
            id="btnConfirmClose"
            class="iconBtn"
            aria-label="Close confirm"
            title="Close"
          >
            ‚úï
          </button>
        </div>

        <div class="row row--gap row--end">
          <button id="btnConfirmCancel" class="btn btn--ghost" type="button">
            Cancel
          </button>
          <button id="btnConfirmOk" class="btn btn--danger" type="button">
            Delete
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
